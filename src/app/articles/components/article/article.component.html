<div class="page-wrapper">

    <!-- Header -->
    <app-header></app-header>

    <div class="container" style="position: relative;">
        <div class="button-back">
            <button class="button-transparent" (click)="prevRoute()">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16.875 10.625H4.40656L9.18094 15.1725C9.43094 15.4106 9.44063 15.8063 9.2025 16.0563C8.96469 16.3059 8.56906 16.3159 8.31875 16.0778L2.86625 10.8841C2.63031 10.6478 2.5 10.3341 2.5 10C2.5 9.66625 2.63031 9.35219 2.87719 9.10563L8.31906 3.9225C8.44 3.80719 8.595 3.75 8.75 3.75C8.915 3.75 9.08 3.815 9.20281 3.94406C9.44094 4.19406 9.43125 4.58938 9.18125 4.8275L4.38688 9.375H16.875C17.22 9.375 17.5 9.655 17.5 10C17.5 10.345 17.22 10.625 16.875 10.625Z" fill="#5BAA89"/>
                </svg>                    

                Назад
            </button>
        </div>

        <div class="article-container" *ngIf="article">

            <!-- Head -->
            <div class="article-head">

                <!-- Image -->
                <div class="article-image">
                    <img [src]="article.image.url" />
                </div>

                <!-- Info -->
                <div class="article-info">

                    <!-- Title -->
                    <div class="article-title">
                        {{ article.title }}
                    </div>

                    <!-- Likes -->
                    <div class="article-likes" [ngClass]="{'liked': article.isLiked}" (click)="likeArticle()">
                        {{ article.likes.length }}

                        <svg *ngIf="!article.isLiked" width="16" height="16" viewBox="0 0 16 16" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M4.16952 2.04431C2.69139 2.30367 1.20039 3.73521 1.20039 6.43427C1.20039 7.40787 1.60689 8.41964 2.25943 9.41028C2.90983 10.3977 3.7843 11.3331 4.67071 12.1458C5.55553 12.9571 6.4421 13.6368 7.10835 14.1141C7.44111 14.3525 7.71804 14.5398 7.91116 14.6671C7.94327 14.6883 7.97305 14.7078 8.00039 14.7256C8.02772 14.7078 8.05751 14.6883 8.08962 14.6671C8.28274 14.5398 8.55967 14.3525 8.89244 14.1141C9.55868 13.6368 10.4453 12.9571 11.3301 12.1458C12.2165 11.3331 13.0909 10.3977 13.7413 9.41028C14.3939 8.41964 14.8004 7.40787 14.8004 6.43427C14.8004 3.73521 13.3094 2.30367 11.8313 2.04432C11.0828 1.91299 10.3199 2.07423 9.70037 2.53131C9.08314 2.9867 8.58071 3.75678 8.39515 4.89183H7.60563C7.42007 3.75677 6.91764 2.9867 6.30041 2.53131C5.68089 2.07422 4.91795 1.91299 4.16952 2.04431ZM8.00039 15.2002C7.79055 15.5407 7.79045 15.5406 7.79032 15.5406L7.78993 15.5403L7.78865 15.5395L7.78416 15.5367L7.76752 15.5264C7.75308 15.5173 7.73203 15.5041 7.70481 15.4868C7.65037 15.4521 7.57121 15.4012 7.47087 15.335C7.27024 15.2028 6.98467 15.0096 6.64244 14.7645C5.95868 14.2746 5.04525 13.5746 4.13007 12.7355C3.21648 11.8979 2.29095 10.9124 1.59135 9.85035C0.893891 8.79153 0.400391 7.62527 0.400391 6.43427C0.400385 3.41224 2.10938 1.59357 4.03126 1.25635C4.98282 1.08939 5.96989 1.29327 6.77537 1.88756C7.27966 2.25963 7.70203 2.77652 8.00039 3.43155C8.29875 2.77652 8.72112 2.25963 9.22541 1.88756C10.0309 1.29328 11.018 1.08939 11.9695 1.25635C13.8914 1.59357 15.6004 3.41224 15.6004 6.43427C15.6004 7.62527 15.1069 8.79153 14.4094 9.85035C13.7098 10.9124 12.7843 11.8979 11.8707 12.7355C10.9555 13.5746 10.0421 14.2746 9.35835 14.7645C9.01611 15.0096 8.73054 15.2028 8.52991 15.335C8.42957 15.4012 8.35042 15.4521 8.29597 15.4868C8.26875 15.5041 8.2477 15.5173 8.23327 15.5264L8.21663 15.5367L8.21213 15.5395L8.21085 15.5403L8.21046 15.5406C8.21033 15.5406 8.21023 15.5407 8.00039 15.2002ZM8.00039 15.2002L8.21023 15.5407L8.00039 15.67L7.79055 15.5407L8.00039 15.2002Z"
                                fill="#A9A9A9" />
                        </svg>

                        <svg *ngIf="article.isLiked" width="16" height="16" viewBox="0 0 16 16" fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M4.16952 2.04431C2.69139 2.30367 1.20039 3.73521 1.20039 6.43427C1.20039 7.40787 1.60689 8.41964 2.25943 9.41028C2.90983 10.3977 3.7843 11.3331 4.67071 12.1458C5.55553 12.9571 6.4421 13.6368 7.10835 14.1141C7.44111 14.3525 7.71804 14.5398 7.91116 14.6671C7.94327 14.6883 7.97305 14.7078 8.00039 14.7256C8.02772 14.7078 8.05751 14.6883 8.08962 14.6671C8.28274 14.5398 8.55967 14.3525 8.89244 14.1141C9.55868 13.6368 10.4453 12.9571 11.3301 12.1458C12.2165 11.3331 13.0909 10.3977 13.7413 9.41028C14.3939 8.41964 14.8004 7.40787 14.8004 6.43427C14.8004 3.73521 13.3094 2.30367 11.8313 2.04432C11.0828 1.91299 10.3199 2.07423 9.70037 2.53131C9.08314 2.9867 8.58071 3.75678 8.39515 4.89183H7.60563C7.42007 3.75677 6.91764 2.9867 6.30041 2.53131C5.68089 2.07422 4.91795 1.91299 4.16952 2.04431ZM8.00039 15.2002C7.79055 15.5407 7.79045 15.5406 7.79032 15.5406L7.78993 15.5403L7.78865 15.5395L7.78416 15.5367L7.76752 15.5264C7.75308 15.5173 7.73203 15.5041 7.70481 15.4868C7.65037 15.4521 7.57121 15.4012 7.47087 15.335C7.27024 15.2028 6.98467 15.0096 6.64244 14.7645C5.95868 14.2746 5.04525 13.5746 4.13007 12.7355C3.21648 11.8979 2.29095 10.9124 1.59135 9.85035C0.893891 8.79153 0.400391 7.62527 0.400391 6.43427C0.400385 3.41224 2.10938 1.59357 4.03126 1.25635C4.98282 1.08939 5.96989 1.29327 6.77537 1.88756C7.27966 2.25963 7.70203 2.77652 8.00039 3.43155C8.29875 2.77652 8.72112 2.25963 9.22541 1.88756C10.0309 1.29328 11.018 1.08939 11.9695 1.25635C13.8914 1.59357 15.6004 3.41224 15.6004 6.43427C15.6004 7.62527 15.1069 8.79153 14.4094 9.85035C13.7098 10.9124 12.7843 11.8979 11.8707 12.7355C10.9555 13.5746 10.0421 14.2746 9.35835 14.7645C9.01611 15.0096 8.73054 15.2028 8.52991 15.335C8.42957 15.4012 8.35042 15.4521 8.29597 15.4868C8.26875 15.5041 8.2477 15.5173 8.23327 15.5264L8.21663 15.5367L8.21213 15.5395L8.21085 15.5403L8.21046 15.5406C8.21033 15.5406 8.21023 15.5407 8.00039 15.2002ZM8.00039 15.2002L8.21023 15.5407L8.00039 15.67L7.79055 15.5407L8.00039 15.2002Z"
                                fill="#D50026" />
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M8.21085 15.5403L8.00039 15.2002L7.79032 15.5406L8.00039 15.67L8.21085 15.5403Z"
                                fill="#D50026" />
                            <path
                                d="M1.20039 6.43427C1.20039 3.73521 2.69139 2.30367 4.16952 2.04431C4.91795 1.91299 5.68089 2.07422 6.30041 2.53131C6.91764 2.9867 7.42007 3.75677 7.60563 4.89183H8.39515C8.58071 3.75678 9.08314 2.9867 9.70037 2.53131C10.3199 2.07423 11.0828 1.91299 11.8313 2.04432C13.3094 2.30367 14.8004 3.73521 14.8004 6.43427C14.8004 7.40787 14.3939 8.41964 13.7413 9.41028C13.0909 10.3977 12.2165 11.3331 11.3301 12.1458C10.4453 12.9571 9.55868 13.6368 8.89244 14.1141C8.55967 14.3525 8.28274 14.5398 8.08962 14.6671C8.05751 14.6883 8.02772 14.7078 8.00039 14.7256C7.97305 14.7078 7.94327 14.6883 7.91116 14.6671C7.71804 14.5398 7.44111 14.3525 7.10835 14.1141C6.4421 13.6368 5.55553 12.9571 4.67071 12.1458C3.7843 11.3331 2.90983 10.3977 2.25943 9.41028C1.60689 8.41964 1.20039 7.40787 1.20039 6.43427Z"
                                fill="#D50026" />
                        </svg>
                    </div>

                    <!-- Comments -->
                    <div class="article-comments">
                        {{ article.comments.length }}

                        <img src="../../../../assets/images/icon-comment.svg" />
                    </div>

                    <!-- Date -->
                    <div class="article-date">
                        <img src="../../../../assets/images/icon-calendar.svg" />

                        {{ article.date | date: 'dd MMM yyy' }}
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="article-content">

                <!-- Article Text -->
                <div class="article-text" [innerHTML]="article.text"></div>

                <!-- Article Sidebar -->
                <div class="article-sidebar">
                    <div class="article-sidebar-inner">
                        <!-- Author -->
                        <div class="author-block" [ngClass]="{'is-specialist': isSpecialist}">
                            <div class="content-wrapper">

                                <div class="title">Автор</div>

                                <div class="author-name" [routerLink]="['/specialists', article.author.id]">
                                    {{ article.author.user.firstName }} {{ article.author.user.lastName }}
                                </div>

                                <div class="author-info">
                                    <div class="author-photo">
                                        <img [src]="article.author.user.photo.url" />
                                    </div>

                                    <div class="author-price">
                                        {{ article.author.price | number:'':'fr' }} ₽
                                    </div>

                                    <div class="author-rating">
                                        <app-rating [score]="article.author.rating" [single]="true" [size]="20"></app-rating>

                                        <div class="rating-count">
                                            {{ article.author.rating }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sign Up Button -->
                        <div class="signup-button" *ngIf="!isSpecialist">
                            <button type="button" (click)="showSpecialistDialog(article.author)">Записаться</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comments -->
            <div class="article-comments">

                <!-- Head -->
                <div class="article-comments-head">
                    Комментарии ({{ article.comments.length }})
                </div>

                <!-- Comments List -->
                <div class="article-comments-list">

                    <!-- Comment -->
                    <div class="article-comment" *ngFor="let comment of comments">

                        <div class="comment-content">

                            <div class="reply-background" *ngIf="replyID == comment.id" [@replyAnimation]></div>

                            <!-- Comment Head -->
                            <div class="comment-head">
                                <div class="comment-author">
                                    <div class="avatar">
                                        {{ getAvatar(comment.author) }}
                                    </div>

                                    <div class="name">
                                        {{ comment.author.firstName }} {{ comment.author.lastName }}
                                    </div>
                                </div>

                                <div class="comment-date">
                                    <div class="icon">
                                        <img src="../../../../assets/images/icon-calendar.svg" />
                                    </div>

                                    {{ comment.date | date: 'dd MMM yyy' : '+3' }} в
                                    {{ comment.date | date: 'HH:mm' : '+6' }}
                                </div>
                            </div>

                            <!-- Comment Text -->
                            <div class="comment-text" [ngClass]="{'reply': replyID == comment.id}" [innerHTML]="comment.text"></div>

                            <!-- Comment date mobile -->
                            <div class="comment-date comment-date-mobile">
                                <div class="icon">
                                    <img src="../../../../assets/images/icon-calendar.svg" />
                                </div>

                                {{ comment.date | date: 'dd MMM yyy' : '+3' }} в
                                {{ comment.date | date: 'HH:mm' : '+6' }}
                            </div>

                            <!-- Reply Button -->
                            <div class="reply-button" (click)="setReply(comment.id)">
                                Ответить
                            </div>
                        </div>

                        <!-- Comment Replies -->
                        <div class="comment-replies">
                            <div class="article-comment" *ngFor="let replie of getReplies(comment.id)">

                                <div class="comment-content">

                                    <div class="reply-background" *ngIf="replyID == replie.id" [@replyAnimation]></div>

                                    <!-- Comment Head -->
                                    <div class="comment-head">
                                        <div class="comment-author">
                                            <div class="avatar" style="background: #5E7ADD;">
                                                {{ getAvatar(replie.author) }}
                                            </div>

                                            <div class="name">
                                                {{ replie.author.firstName }} {{ replie.author.lastName }}
                                            </div>
                                        </div>

                                        <div class="comment-date">
                                            <div class="icon">
                                                <img src="../../../../assets/images/icon-calendar.svg" />
                                            </div>

                                            {{ replie.date | date: 'dd MMM yyy' : '+3' }} в
                                            {{ replie.date | date: 'HH:mm' : '+6' }}
                                        </div>
                                    </div>

                                    <!-- Comment Text -->
                                    <div class="comment-text">
                                        <a (click)="showReply(replie.parentComment.id)"
                                            class="reply-link">{{ replie.parentComment.author.firstName }}</a>,
                                        {{ replie.text }}
                                    </div>

                                    <!-- Comment date mobile -->
                                    <div class="comment-date comment-date-mobile">
                                        <div class="icon">
                                            <img src="../../../../assets/images/icon-calendar.svg" />
                                        </div>

                                        {{ comment.date | date: 'dd MMM yyy' : '+3' }} в
                                        {{ comment.date | date: 'HH:mm' : '+6' }}
                                    </div>

                                    <!-- Reply Button -->
                                    <div class="reply-button" (click)="setReplyToReply(comment.id, replie.id)">
                                        Ответить
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Comment -->
                <div class="article-add-comment">
                    <div class="comment-area">
                        <div class="textarea"
                            #commentArea
                            contenteditable="true" 
                            placeholder="Ваш комментарий...">
                        </div>
                    </div>

                    <div class="submit-button">
                        <button type="button" class="button-green" (click)="submitComment()">Отправить</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <app-footer></app-footer>
</div>

<choose-specialist-dialog class="choose-specialist-dialog hidden"></choose-specialist-dialog>